<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day 2 - Finding neighbours &mdash; Weak Lensing 2022 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Day 3 - Get the Weak Lensing Signals" href="get_signals.html" />
    <link rel="prev" title="Day 1 - Introduction" href="instructions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Weak Lensing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="instructions.html">Day 1 - Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Day 2 - Finding neighbours</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Reading-the-lens/source-catalog">Reading the lens/source catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Visualising-the-coordinate-space-of-input-data">Visualising the coordinate space of input data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#On-sky-distance-between-two-points-on-the-surface-of-a-unit-sphere"><code class="docutils literal notranslate"><span class="pre">On-sky</span> <span class="pre">distance</span></code> between two points on the surface of a unit sphere</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Brute-force-search-for-neighbour-objects-within-a-specified-distance"><code class="docutils literal notranslate"><span class="pre">Brute</span> <span class="pre">force</span> <span class="pre">search</span> <span class="pre">for</span> <span class="pre">neighbour</span> <span class="pre">objects</span></code> within a specified distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Testing-the-above-function-find_neighbour_points-(brute-force-search)">Testing the above function <code class="docutils literal notranslate"><span class="pre">find_neighbour_points</span></code> (brute force search)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#A-visual-sanity-check-for-execution-of-find_neighbour_points-function">A visual sanity check for execution of <code class="docutils literal notranslate"><span class="pre">find_neighbour_points</span></code> function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-k-d-tree-algorithm-to-query-the-neighbour-points-within-a-given-distance">Using k-d tree algorithm to query the neighbour points within a given distance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#We’ll-use-the-spatial.cKDTree-package-from-scipy.">We’ll use the <code class="docutils literal notranslate"><span class="pre">spatial.cKDTree</span></code> package from <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Write-a-wrapper-code-using-cKDTree-to-find-out-the-neighbours-of-a-given-set1-of-objects-(coordinates)-from-a-catalog-of-other-objects,-set2">Write a wrapper code using cKDTree to find out the neighbours of a given <code class="docutils literal notranslate"><span class="pre">set1</span></code> of objects (coordinates) from a catalog of other objects, <code class="docutils literal notranslate"><span class="pre">set2</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Testing-conversion-of-(ra,dec)-to-(x,y,z)">Testing conversion of (ra,dec) to (x,y,z)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Demo-objects-for-which-we’ll-compare-the-output-of-our-brute-force-algorithm-with-cKDTree-algorithm">Demo objects for which we’ll compare the output of our brute force algorithm with cKDTree algorithm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Compare-the-computer-time-required-by-our-brute-force-algorithm-vs-the-k-d-tree-algorithm">Compare the computer time required by our brute force algorithm vs the k-d tree algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="get_signals.html">Day 3 - Get the Weak Lensing Signals</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Weak Lensing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Day 2 - Finding neighbours</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pair_counting.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Day-2---Finding-neighbours">
<h1>Day 2 - Finding neighbours<a class="headerlink" href="#Day-2---Finding-neighbours" title="Permalink to this headline"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="n">javascript_functions</span> <span class="o">=</span> <span class="p">{</span><span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;hide()&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;show()&quot;</span><span class="p">}</span>
<span class="n">button_descriptions</span>  <span class="o">=</span> <span class="p">{</span><span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;Show code&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;Hide code&quot;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">toggle_code</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles the JavaScript show()/hide() function on the div.input element.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output_string</span> <span class="o">=</span> <span class="s2">&quot;&lt;script&gt;$(</span><span class="se">\&quot;</span><span class="s2">div.input</span><span class="se">\&quot;</span><span class="s2">).</span><span class="si">{}</span><span class="s2">&lt;/script&gt;&quot;</span>
    <span class="n">output_args</span>   <span class="o">=</span> <span class="p">(</span><span class="n">javascript_functions</span><span class="p">[</span><span class="n">state</span><span class="p">],)</span>
    <span class="n">output</span>        <span class="o">=</span> <span class="n">output_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">output_args</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">button_action</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the toggle_code function and updates the button description.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">new</span>

    <span class="n">toggle_code</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">value</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">button_descriptions</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>


<span class="n">state</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">toggle_code</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<span class="n">button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="n">button_descriptions</span><span class="p">[</span><span class="n">state</span><span class="p">])</span>
<span class="n">button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">button_action</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<script>$("div.input").hide()</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0251cf2a707b40b9bb3867f461afe390", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
</pre></div>
</div>
</div>
<div class="section" id="Reading-the-lens/source-catalog">
<h2>Reading the lens/source catalog<a class="headerlink" href="#Reading-the-lens/source-catalog" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head -n <span class="m">5</span> /home/idies/workspace/Storage/navin/persistent/demo_objects.csv
<span class="c1"># !wc -l /home/idies/workspace/Storage/navin/persistent/demo_objects.csv</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ra,dec,z,col_3,col_4,col_5
30.611734783139795,-6.3569091978972425,23.901826,23.043298,22.649281,0.5
30.61078116389429,-6.350381359287763,22.385773,21.548382,21.272576,0.38
30.596477830319948,-6.3461523588063935,23.948118,23.121471,22.773187,0.37
30.592680083175416,-6.3445214768250775,23.42731400000001,22.022285999999998,21.334948,0.45
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#reading lens file</span>

<span class="c1">#tries to read everthing in the file</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/home/idies/workspace/Storage/navin/persistent/demo_objects.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p># a brief look of what dataFrame has for us-</p>
<p>Data from - <code class="docutils literal notranslate"><span class="pre">HSC</span> <span class="pre">survey</span></code> ra,dec - coordinates in units of degrees. z - photometric redshifts of the objects.</p>
<p>col_1,col_2,col_3 - extra columns which have to be ignored</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ra</th>
      <th>dec</th>
      <th>z</th>
      <th>col_3</th>
      <th>col_4</th>
      <th>col_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30.611735</td>
      <td>-6.356909</td>
      <td>23.901826</td>
      <td>23.043298</td>
      <td>22.649281</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30.610781</td>
      <td>-6.350381</td>
      <td>22.385773</td>
      <td>21.548382</td>
      <td>21.272576</td>
      <td>0.38</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30.596478</td>
      <td>-6.346152</td>
      <td>23.948118</td>
      <td>23.121471</td>
      <td>22.773187</td>
      <td>0.37</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30.592680</td>
      <td>-6.344521</td>
      <td>23.427314</td>
      <td>22.022286</td>
      <td>21.334948</td>
      <td>0.45</td>
    </tr>
    <tr>
      <th>4</th>
      <td>30.601111</td>
      <td>-6.338650</td>
      <td>21.660045</td>
      <td>20.812223</td>
      <td>20.383688</td>
      <td>0.32</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p># select required columns only</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/home/idies/workspace/Storage/navin/persistent/demo_objects.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ra</th>
      <th>dec</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30.611735</td>
      <td>-6.356909</td>
      <td>23.901826</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30.610781</td>
      <td>-6.350381</td>
      <td>22.385773</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30.596478</td>
      <td>-6.346152</td>
      <td>23.948118</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30.592680</td>
      <td>-6.344521</td>
      <td>23.427314</td>
    </tr>
    <tr>
      <th>4</th>
      <td>30.601111</td>
      <td>-6.338650</td>
      <td>21.660045</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Visualising-the-coordinate-space-of-input-data">
<h2>Visualising the coordinate space of input data<a class="headerlink" href="#Visualising-the-coordinate-space-of-input-data" title="Permalink to this headline"></a></h2>
<p># write a python code to plot <code class="docutils literal notranslate"><span class="pre">dec(on</span> <span class="pre">Y-axis)</span> <span class="pre">vs</span> <span class="pre">ra(on</span> <span class="pre">X-axis)</span></code> of the objects passed in the dataFrame</p>
<p># this plot will look very dense, so in order to visually see the points distributed on the (ra,dec) plane, downsample the number of points by 100 and again plot. In order to downsample the points, use <code class="docutils literal notranslate"><span class="pre">numpy.random.choise()</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span>

<span class="c1">#plot all the coordinates</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;ra (deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;dec (deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Plot looks too dense.</span><span class="se">\n</span><span class="s2">let&#39;s reduce the density of points and have another look.&quot;</span><span class="p">)</span>

<span class="c1">#Randomly picking up points to plots to reduce the density of points</span>
<span class="n">Number_of_points</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">size</span>
<span class="n">down_sample_by</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">random_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Number_of_points</span><span class="p">),</span>
                                  <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">Number_of_points</span><span class="o">/</span><span class="n">down_sample_by</span><span class="p">),</span>
                                  <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#plot down sampled number coordinates</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">random_indices</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">random_indices</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;ra (deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;dec (deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/pair_counting_13_0.png" src="_images/pair_counting_13_0.png" />
</div>
</div>
</div>
<div class="section" id="On-sky-distance-between-two-points-on-the-surface-of-a-unit-sphere">
<h2><code class="docutils literal notranslate"><span class="pre">On-sky</span> <span class="pre">distance</span></code> between two points on the surface of a unit sphere<a class="headerlink" href="#On-sky-distance-between-two-points-on-the-surface-of-a-unit-sphere" title="Permalink to this headline"></a></h2>
<p><span class="math notranslate nohighlight">\(\cos(\theta)=\frac{\vec{r_1}\cdot\vec{r_2}}{r_1 r_2}\)</span></p>
<p>set <span class="math notranslate nohighlight">\(r_1=r_2=1\)</span></p>
<p>get <span class="math notranslate nohighlight">\(\theta\)</span></p>
<p>Using: <span class="math notranslate nohighlight">\(\mathrm{arc\_distance}=s=r \times \theta\)</span>, obtain the distance between the two ra,dec values. Since <span class="math notranslate nohighlight">\(r_1=r_2=1\)</span>,</p>
<p><span class="math notranslate nohighlight">\(\Rightarrow s=\theta\)</span> (radians)</p>
<p># <code class="docutils literal notranslate"><span class="pre">Using</span> <span class="pre">the</span> <span class="pre">above</span> <span class="pre">formula</span></code> -</p>
<p>Implement a function which takes tuples of (ra,dec) of two objects and returns the distance between them on the Unit sphere. Your code should return the <code class="docutils literal notranslate"><span class="pre">result</span> <span class="pre">in</span> <span class="pre">units</span> <span class="pre">of</span> <span class="pre">arc</span> <span class="pre">seconds</span> <span class="pre">and</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">radians</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rad_to_arcsec</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">*</span><span class="mf">3600.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">arcsec_to_rad</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">rad_to_arcsec</span>

<span class="k">def</span> <span class="nf">dist_betw_two_obj</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span><span class="n">obj2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;dot prod formula&quot;&quot;&quot;</span>
    <span class="n">ra1</span><span class="p">,</span><span class="n">dec1</span> <span class="o">=</span> <span class="n">obj1</span>
    <span class="n">ra2</span><span class="p">,</span><span class="n">dec2</span> <span class="o">=</span> <span class="n">obj2</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">dec2</span><span class="p">))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">dec1</span><span class="p">))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">ra1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">ra2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">dec1</span><span class="p">))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">dec2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">arg</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="c1">#the problematic ones which are being set to 1.0 are different from 1.0 at a decimal point which is beyond the precision level supported by the ra,dec&#39;s themselves.</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">*</span> <span class="n">rad_to_arcsec</span>
    <span class="k">return</span> <span class="n">dist</span>
<br/></pre></div>
</div>
</div>
<p>Running and testing the distance computation code:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># creating tuple of values from ra,dec of each object</span>
<span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="c1"># print(coords[0])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;obj 1: </span><span class="si">{coords[0]}</span><span class="s2"></span>
<span class="s2">obj2 2: </span><span class="si">{coords[1]}</span><span class="s2"></span>
<span class="s2">distance: {dist_betw_two_obj(coords[0],coords[1])} arcsec&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
obj 1: (30.611734783139795, -6.3569091978972425)
obj2 2: (30.61078116389429, -6.350381359287763)
distance: 23.7466131834144 arcsec
</pre></div></div>
</div>
</div>
<div class="section" id="Brute-force-search-for-neighbour-objects-within-a-specified-distance">
<h2><code class="docutils literal notranslate"><span class="pre">Brute</span> <span class="pre">force</span> <span class="pre">search</span> <span class="pre">for</span> <span class="pre">neighbour</span> <span class="pre">objects</span></code> within a specified distance<a class="headerlink" href="#Brute-force-search-for-neighbour-objects-within-a-specified-distance" title="Permalink to this headline"></a></h2>
<p>time complexity ~ <span class="math notranslate nohighlight">\(\mathcal{O}(n^2)\)</span></p>
<p># write a function <code class="docutils literal notranslate"><span class="pre">find_neighbour_points</span></code> that uses (ra,dec) coordinates of an object, and within some given <code class="docutils literal notranslate"><span class="pre">rmax</span></code> distance, finds its neighbour points in the given dataFrame catalog.</p>
<p># Using this code you should be able to find neighbours of each object in the dataFrame - within the same dataFrame.</p>
<p>Say the <span class="math notranslate nohighlight">\(1^{st}\)</span> object in the dataFrame has 5 objects within say <code class="docutils literal notranslate"><span class="pre">rrmax</span></code>=15 arcsec, then you should be able to print/store the <code class="docutils literal notranslate"><span class="pre">indices</span></code> and <code class="docutils literal notranslate"><span class="pre">distances</span></code> of these neighbours.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">find_neighbour_points</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    finding neighbour objects within some distance, for all the objects in a given array of coordinates.</span>

<span class="sd">    coords: an array/list of tuples (ra,dec)</span>

<span class="sd">    Returns:</span>
<span class="sd">    `nnids`: indices into `coords` of neighbours of each object in `coords` within `rmax`</span>
<span class="sd">    `distances`: distance of objects matched in `nnids&quot;&quot;&quot;</span>

    <span class="c1"># define containers for the distance and id information of matched objects</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">nnids</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="n">c</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">obj1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
        <span class="n">c</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">d</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">obj2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="n">ii</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">d</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">dist_betw_two_obj</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span><span class="n">obj2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">rmax</span><span class="p">:</span>
                <span class="n">nnids</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span>
                <span class="n">distances</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">nnids</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">distances</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">nnids</span><span class="p">,</span><span class="n">distances</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Testing-the-above-function-find_neighbour_points-(brute-force-search)">
<h2>Testing the above function <code class="docutils literal notranslate"><span class="pre">find_neighbour_points</span></code> (brute force search)<a class="headerlink" href="#Testing-the-above-function-find_neighbour_points-(brute-force-search)" title="Permalink to this headline"></a></h2>
<p>Search within a ball of radius <code class="docutils literal notranslate"><span class="pre">rmax</span></code> of 50 objects in the catalog within itself, say for <code class="docutils literal notranslate"><span class="pre">rmax</span></code>(default value)=15 arcsec.</p>
<p>We’re only using 50 points in order to reduce the compute time, but the code has no such limitation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;object index, neighbours indices list, neighbours distances list &quot;</span><span class="p">)</span>

<span class="c1"># from time import time</span>
<span class="c1"># t=time()</span>
<span class="c1"># nnids,distances = find_neighbour_points(coords[:100],rmax=15)</span>
<span class="c1"># print(f&quot;total time taken to run = {time()-t}&quot;)</span>


<span class="o">%</span><span class="k">time</span> nnids,distances = find_neighbour_points(coords[:50],rmax=15)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
object index, neighbours indices list, neighbours distances list
0 [] []
1 [] []
2 [3] [14.802299176580224]
3 [2] [14.802299176580224]
4 [36] [13.682331312465545]
5 [] []
6 [] []
7 [] []
8 [13] [9.465537930627812]
9 [10, 12, 38] [10.94680374083333, 5.876628853240463, 14.594679725290598]
10 [9, 12] [10.94680374083333, 10.280601486171243]
11 [42] [7.151725370768233]
12 [9, 10, 14] [5.876628853240463, 10.280601486171243, 11.314136132011965]
13 [8] [9.465537930627812]
14 [12, 15, 16] [11.314136132011965, 5.475958296970058, 11.765854084075805]
15 [14, 16, 44] [5.475958296970058, 13.47975484115049, 10.276694006812336]
16 [14, 15] [11.765854084075805, 13.47975484115049]
17 [46] [6.898087849306218]
18 [] []
19 [] []
20 [] []
21 [] []
22 [] []
23 [] []
24 [] []
25 [26] [13.29908354885402]
26 [25] [13.29908354885402]
27 [] []
28 [] []
29 [30] [3.6918325238285883]
30 [29] [3.6918325238285883]
31 [] []
32 [] []
33 [] []
34 [] []
35 [36] [10.896870606370635]
36 [4, 35] [13.682331312465545, 10.896870606370635]
37 [] []
38 [9, 40] [14.594679725290598, 14.719522078343205]
39 [40] [1.984703189527645]
40 [38, 39] [14.719522078343205, 1.984703189527645]
41 [] []
42 [11] [7.151725370768233]
43 [] []
44 [15] [10.276694006812336]
45 [] []
46 [17] [6.898087849306218]
47 [] []
48 [] []
49 [] []
CPU times: user 136 ms, sys: 8.79 ms, total: 145 ms
Wall time: 140 ms
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nth</span> <span class="o">=</span> <span class="mi">15</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Accessing the neighbour points for the </span><span class="si">{nth}</span><span class="s2">th object using the output</span>
<span class="s2">of our brute force method:&quot;&quot;&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;neighbours: </span><span class="si">{nnids[nth]}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">distances: </span><span class="si">{distances[nth]}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accessing the neighbour coordinates of the </span><span class="si">{nth}</span><span class="s2">th object:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">nnids</span><span class="p">[</span><span class="n">nth</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accessing the neighbour points for the 15th object using the output
of our brute force method:
neighbours: [14, 16, 44]
distances: [5.475958296970058, 13.47975484115049, 10.276694006812336]

Accessing the neighbour coordinates of the 15th object:
14 (30.564297942270603, -6.322030429805476)
16 (30.562347805639572, -6.319398928221537)
44 (30.568297869918087, -6.3202347701814166)
</pre></div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="A-visual-sanity-check-for-execution-of-find_neighbour_points-function">
<h2>A visual sanity check for execution of <code class="docutils literal notranslate"><span class="pre">find_neighbour_points</span></code> function<a class="headerlink" href="#A-visual-sanity-check-for-execution-of-find_neighbour_points-function" title="Permalink to this headline"></a></h2>
<p>Let’s plot the coordinates of the neighbours of some test point.</p>
<p>This exercise can help us visually inspect whether our neighbour search code gave us reasonable results or not.</p>
<p>I’m plotting the neighbours of <span class="math notranslate nohighlight">\(15^{th}\)</span> point from the catalog. And also printing their <code class="docutils literal notranslate"><span class="pre">indices</span></code> and <code class="docutils literal notranslate"><span class="pre">distances</span></code> to compare the stored distances by eye!</p>
<p>Point marked as <span class="math notranslate nohighlight">\(\star\)</span> is the <span class="math notranslate nohighlight">\(15^{th}\)</span> point. Other points are its neighbours.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demoid</span> <span class="o">=</span> <span class="mi">15</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1">#plot demo point</span>
<span class="n">demora</span><span class="p">,</span><span class="n">demodec</span>  <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">demoid</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">demora</span><span class="p">,</span><span class="n">demodec</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>

<span class="c1">#access all the neighbours</span>
<span class="n">coords</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<span class="n">neighbours</span> <span class="o">=</span> <span class="n">nnids</span><span class="p">[</span><span class="n">demoid</span><span class="p">]</span>

<span class="c1">#choose colors for a given number of neighbours</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="c1"># colors = np.random.random( size=(len(neighbours),3) )</span>

<span class="c1">#plot all the neighbour points</span>
<span class="n">plotra</span>  <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">[</span><span class="n">neighbours</span><span class="p">]</span> <span class="p">]</span>
<span class="n">plotdec</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">[</span><span class="n">neighbours</span><span class="p">]</span> <span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">plotra</span><span class="p">,</span> <span class="n">plotdec</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plotra</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">demora</span><span class="p">,</span><span class="n">plotra</span><span class="p">[</span><span class="n">i</span><span class="p">]],[</span><span class="n">demodec</span><span class="p">,</span><span class="n">plotdec</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;ra (deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;dec (deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># plt.savefig(&quot;first.png&quot;,bbox_inches=&quot;tight&quot;)</span>

<span class="c1"># Now visuall compare the distances</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index--&gt; distance</span><span class="se">\t\t</span><span class="s2">color&quot;</span><span class="p">)</span>
<span class="n">ndist</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">demoid</span><span class="p">]</span>
<span class="k">for</span> <span class="n">nidx</span><span class="p">,</span><span class="n">dist</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">neighbours</span><span class="p">,</span><span class="n">ndist</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">nidx</span><span class="p">,</span><span class="s2">&quot;---&gt;&quot;</span><span class="p">,</span><span class="n">dist</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/pair_counting_29_0.png" src="_images/pair_counting_29_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
index--&gt; distance            color
14 ---&gt; 5.475958296970058     r
16 ---&gt; 13.47975484115049     g
44 ---&gt; 10.276694006812336    b
</pre></div></div>
</div>
<hr class="docutils" />
</div>
<div class="section" id="Using-k-d-tree-algorithm-to-query-the-neighbour-points-within-a-given-distance">
<h2>Using k-d tree algorithm to query the neighbour points within a given distance<a class="headerlink" href="#Using-k-d-tree-algorithm-to-query-the-neighbour-points-within-a-given-distance" title="Permalink to this headline"></a></h2>
<p>time complexity ~ <span class="math notranslate nohighlight">\(\mathcal{O}(n\log{}n)\)</span></p>
<div class="section" id="We’ll-use-the-spatial.cKDTree-package-from-scipy.">
<h3>We’ll use the <code class="docutils literal notranslate"><span class="pre">spatial.cKDTree</span></code> package from <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.<a class="headerlink" href="#We’ll-use-the-spatial.cKDTree-package-from-scipy." title="Permalink to this headline"></a></h3>
<p>If you have many points whose neighbors you want to find, you may save substantial amounts of time by putting them in a <code class="docutils literal notranslate"><span class="pre">cKDTree</span></code> and using functions defined on this tree. For example: <code class="docutils literal notranslate"><span class="pre">query_ball_point</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="n">sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span>
<span class="n">cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span>
<span class="n">deg2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Write-a-wrapper-code-using-cKDTree-to-find-out-the-neighbours-of-a-given-set1-of-objects-(coordinates)-from-a-catalog-of-other-objects,-set2">
<h2>Write a wrapper code using cKDTree to find out the neighbours of a given <code class="docutils literal notranslate"><span class="pre">set1</span></code> of objects (coordinates) from a catalog of other objects, <code class="docutils literal notranslate"><span class="pre">set2</span></code><a class="headerlink" href="#Write-a-wrapper-code-using-cKDTree-to-find-out-the-neighbours-of-a-given-set1-of-objects-(coordinates)-from-a-catalog-of-other-objects,-set2" title="Permalink to this headline"></a></h2>
<p># Write this code in a <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">structure</span></code> where it takes-in arrays of <code class="docutils literal notranslate"><span class="pre">ra,dec</span></code> of the catalog objects (set2) and - converts (ra,dec) to (x,y,z) of cartesian coordinates. - creates k-d tree of the catalog objects using (x,y,x) - queries for the neighbour points of each object in the <code class="docutils literal notranslate"><span class="pre">set1</span></code> using its ra,dec</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">find_neighbours</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tdec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;r==1 --&gt; unit sphere calculations&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tra</span> <span class="o">=</span> <span class="n">tra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tdec</span><span class="o">=</span> <span class="n">tdec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rad_to_arcsec</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">*</span><span class="mf">3600.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arcsec_to_rad</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rad_to_arcsec</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing with sphere of radius, r=</span><span class="si">{r}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="c1"># write a function that converts ra,dec to cartesian components.</span>
    <span class="k">def</span> <span class="nf">RA_DEC_to_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;converts ra,dec to cartesian x,y,z components on a unit sphere&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">==</span><span class="s2">&quot;deg&quot;</span><span class="p">:</span>
            <span class="n">ra</span> <span class="o">=</span> <span class="n">deg2rad</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
            <span class="n">dec</span><span class="o">=</span> <span class="n">deg2rad</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>

    <span class="c1"># write a function `create_tree` that takes arrays of ra,dec</span>
    <span class="c1"># values as inputs and returns a cKDTree object into these coordinates.</span>

    <span class="k">def</span> <span class="nf">create_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create an array of tuples of x,y,z</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RA_DEC_to_xyz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tra</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tdec</span><span class="p">)</span>
        <span class="c1"># make a tree using cKDTree method</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">cKDTree</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="c1"># write a function that takes arrays of ra,dec coordinates</span>
    <span class="c1"># and returns the neighbour object&#39;s indices from the tree</span>
    <span class="c1"># within some distance `rmax` arcsec .</span>

    <span class="k">def</span> <span class="nf">query_within_rmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">):</span>
        <span class="c1">#convert rmax from arcsec to distance units</span>
        <span class="n">rmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span><span class="n">rmax</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">arcsec_to_rad</span>

        <span class="c1"># array of tuples of x,y,z of input objetcs</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RA_DEC_to_xyz</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">)</span>
        <span class="n">cartesian_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>

        <span class="c1"># make tree from catalog</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_tree</span><span class="p">()</span>

        <span class="c1"># look for the neighbour objects</span>
        <span class="n">ids_into_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_ball_point</span><span class="p">(</span><span class="n">cartesian_coords</span><span class="p">,</span><span class="n">rmax</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ids_into_tree</span>
</pre></div>
</div>
</div>
<div class="section" id="Testing-conversion-of-(ra,dec)-to-(x,y,z)">
<h3>Testing conversion of (ra,dec) to (x,y,z)<a class="headerlink" href="#Testing-conversion-of-(ra,dec)-to-(x,y,z)" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">code</span> <span class="o">=</span> <span class="n">find_neighbours</span><span class="p">()</span>

<span class="c1"># a look at the cartesian coordinates</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">RA_DEC_to_xyz</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cartesian_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shapes of x,y,z arrays:&quot;</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shapes of (x,y,z) tuple array:&quot;</span><span class="p">,</span> <span class="n">cartesian_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1">#field on objects looks close to equator</span>
<span class="n">cartesian_coords</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initializing with sphere of radius, r=1.
shapes of x,y,z arrays: (220622,) (220622,) (220622,)
shapes of (x,y,z) tuple array: (220622, 3)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 0.8553461 ,  0.50608675, -0.11072151],
       [ 0.85536537,  0.50607894, -0.11060828],
       [ 0.85549871,  0.50586954, -0.11053492],
       ...,
       [ 0.78796508,  0.6142163 , -0.04300421],
       [ 0.78737094,  0.61497898, -0.04298683],
       [ 0.78774839,  0.61449982, -0.04292369]])
</pre></div></div>
</div>
</div>
<div class="section" id="Demo-objects-for-which-we’ll-compare-the-output-of-our-brute-force-algorithm-with-cKDTree-algorithm">
<h3>Demo objects for which we’ll compare the output of our brute force algorithm with cKDTree algorithm<a class="headerlink" href="#Demo-objects-for-which-we’ll-compare-the-output-of-our-brute-force-algorithm-with-cKDTree-algorithm" title="Permalink to this headline"></a></h3>
<p># Take the same bunch of objects for which we already have run our brute force search method, and feed them into the wrapper code of k-d tree written above, and find out their neighbour points within the same <code class="docutils literal notranslate"><span class="pre">rmax</span></code>(default value)=15 arcsec.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="c1">#9,15</span>
<span class="n">demo_ra</span> <span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="n">demo_ids</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#deg</span>
<span class="n">demo_dec</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="n">demo_ids</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#deg</span>

<span class="n">demox</span><span class="p">,</span> <span class="n">demoy</span><span class="p">,</span> <span class="n">demoz</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">RA_DEC_to_xyz</span><span class="p">(</span><span class="n">demo_ra</span><span class="p">,</span> <span class="n">demo_dec</span><span class="p">)</span>
<span class="n">demoobj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">demox</span><span class="p">,</span><span class="n">demoy</span><span class="p">,</span><span class="n">demoz</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;indices of test objects in set2(catalog):&quot;</span><span class="p">,</span><span class="n">demo_ids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coordinate of test objects:&quot;</span><span class="p">,</span><span class="n">demoobj</span><span class="p">)</span>

<span class="c1"># we want to look within `rmax` arcsec --&gt; convert `rmax` from (arcsec) angle to length units</span>

<span class="n">rmax</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">arcsec_to_rad</span>
<span class="c1"># print()</span>
<span class="c1"># print(f&quot;rmax={rmax} in radians:&quot;,rmax)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
indices of test objects in set2(catalog): [15]
coordinate of test objects: [[ 0.85581232  0.50543305 -0.11010311]]
</pre></div></div>
</div>
<p># Initialize class and set up the tree</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">code_tree</span> <span class="o">=</span> <span class="n">find_neighbours</span><span class="p">(</span><span class="n">tra</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">tdec</span><span class="o">=</span><span class="n">coords</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initializing with sphere of radius, r=1.
</pre></div></div>
</div>
<p># Query the neighbours of demo objects</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span><span class="o">=</span><span class="n">code_tree</span><span class="o">.</span><span class="n">query_within_rmax</span><span class="p">(</span><span class="n">demo_ra</span><span class="p">,</span> <span class="n">demo_dec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p># Go back to brute force output and compare this result…. does it match?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([list([14, 15, 16, 44])], dtype=object)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Compare-the-computer-time-required-by-our-brute-force-algorithm-vs-the-k-d-tree-algorithm">
<h2>Compare the computer time required by our brute force algorithm vs the k-d tree algorithm<a class="headerlink" href="#Compare-the-computer-time-required-by-our-brute-force-algorithm-vs-the-k-d-tree-algorithm" title="Permalink to this headline"></a></h2>
<p>First let’s use k-d tree to query neighbours within <code class="docutils literal notranslate"><span class="pre">rmax</span></code>=15 arcsec for each object within the catalog.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> idx=code_tree.query_within_rmax(coords[:,0], coords[:,1])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 1.66 s, sys: 74 ms, total: 1.74 s
Wall time: 1.73 s
</pre></div></div>
</div>
<p>Reminder: full catalog has about 2,20,000 objects… and k-d tree found neighbours for each one of them in 1-2 seconds.</p>
<p>Now let’s use the brute force method only for 1000 objects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> nnids,distances = find_neighbour_points(coords[:1000],rmax=15, verbose=False)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 54.2 s, sys: 0 ns, total: 54.2 s
Wall time: 54.2 s
</pre></div></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="instructions.html" class="btn btn-neutral float-left" title="Day 1 - Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="get_signals.html" class="btn btn-neutral float-right" title="Day 3 - Get the Weak Lensing Signals" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Divya Rana.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>